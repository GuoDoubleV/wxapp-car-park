<!--pages/payment/payment.wxml-->
<view class="payment-page" bindtap="hideKeyboard">
  <!-- åœè½¦åœºä¿¡æ¯ -->
  <view class="parking-info">
    <view class="parking-icon">P</view>
    <view class="parking-details">
      <view class="parking-name">{{parkingLot.name || 'å¥¥ä¸œåå…«'}}</view>
      <view class="parking-address">{{parkingLot.address || 'æœé˜³æƒ æ–°è¥¿è¡—å®‰è‹‘è·¯18å·'}}</view>
    </view>
  </view>


  <!-- è½¦ç‰Œè¾“å…¥é¡µé¢ -->
  <view wx:if="{{pageMode === 'input-plate'}}" class="input-plate-content">
    <!-- è½¦ç‰Œè¾“å…¥åŒºåŸŸ -->
    <view class="plate-input-card">
      <view class="card-title">æ·»åŠ è½¦ç‰Œ</view>
      
      <!-- è½¦ç‰Œè¾“å…¥æ¡† -->
      <view class="plate-input-container">
        <view 
          class="plate-input-box {{currentInputIndex === 0 ? 'active' : ''}}"
          bindtap="onPlateInputClick"
          data-index="0"
        >
          {{plateNumber[0]}}
        </view>
        <view class="plate-separator">Â·</view>
        <view 
          class="plate-input-box {{currentInputIndex === 1 ? 'active' : ''}}"
          bindtap="onPlateInputClick"
          data-index="1"
        >
          {{plateNumber[1]}}
        </view>
        <view 
          class="plate-input-box {{currentInputIndex === 2 ? 'active' : ''}}"
          bindtap="onPlateInputClick"
          data-index="2"
        >
          {{plateNumber[2]}}
        </view>
        <view 
          class="plate-input-box {{currentInputIndex === 3 ? 'active' : ''}}"
          bindtap="onPlateInputClick"
          data-index="3"
        >
          {{plateNumber[3]}}
        </view>
        <view 
          class="plate-input-box {{currentInputIndex === 4 ? 'active' : ''}}"
          bindtap="onPlateInputClick"
          data-index="4"
        >
          {{plateNumber[4]}}
        </view>
        <view 
          class="plate-input-box {{currentInputIndex === 5 ? 'active' : ''}}"
          bindtap="onPlateInputClick"
          data-index="5"
        >
          {{plateNumber[5]}}
        </view>
        <view 
          class="plate-input-box {{currentInputIndex === 6 ? 'active' : ''}}"
          bindtap="onPlateInputClick"
          data-index="6"
        >
          {{plateNumber[6]}}
        </view>
        <view 
          class="plate-input-box new-energy {{currentInputIndex === 7 ? 'active' : ''}} {{isNewEnergy ? 'enabled' : ''}}"
          bindtap="onPlateInputClick"
          data-index="7"
        >
          {{plateNumber[7]}}
          <view class="new-energy-label" wx:if="{{isNewEnergy}}">æ–°èƒ½æº</view>
        </view>
      </view>

      <!-- å»ç¼´è´¹æŒ‰é’® -->
      <button class="payment-btn" bindtap="goToPaymentFromInput">å»ç¼´è´¹</button>
    </view>

    <!-- åº•éƒ¨æœåŠ¡é“¾æ¥ -->
    <view class="service-links">
      <view class="service-item" bindtap="vehicleManagement">
        <text class="service-icon">ğŸš—</text>
        <text class="service-text">è½¦è¾†ç®¡ç†</text>
      </view>
      <view class="service-item" bindtap="paymentRecords">
        <view class="service-icon parking-icon-small">P</view>
        <text class="service-text">ç¼´è´¹è®°å½•</text>
      </view>
      <view class="service-item" bindtap="paymentInstructions">
        <text class="service-icon">â„¹</text>
        <text class="service-text">ç¼´è´¹è¯´æ˜</text>
      </view>
    </view>

    <!-- è™šæ‹Ÿé”®ç›˜ -->
    <view class="virtual-keyboard" wx:if="{{showKeyboard}}">
      <!-- çœä»½é”®ç›˜ -->
      <view class="keyboard-row" wx:if="{{keyboardType === 'province'}}">
        <view class="keyboard-row-inner">
          <view 
            class="keyboard-key"
            wx:for="{{provinces}}"
            wx:key="index"
            bindtap="onKeyboardClick"
            data-char="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>

      <!-- æ•°å­—é”®ç›˜ -->
      <view class="keyboard-row" wx:if="{{keyboardType === 'number'}}">
        <view class="keyboard-row-inner">
          <view 
            class="keyboard-key"
            wx:for="{{numbers}}"
            wx:key="index"
            bindtap="onKeyboardClick"
            data-char="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>

      <!-- å­—æ¯é”®ç›˜ -->
      <view class="keyboard-row" wx:if="{{keyboardType === 'letter'}}">
        <view class="keyboard-row-inner">
          <view 
            class="keyboard-key"
            wx:for="{{letters}}"
            wx:key="index"
            bindtap="onKeyboardClick"
            data-char="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>

      <!-- åŠŸèƒ½é”®è¡Œ -->
      <view class="keyboard-function-row">

        <view class="keyboard-key delete-key" bindtap="onKeyboardClick" data-char="delete">
           <van-icon name="arrow-left" />
           <van-icon name="cross" />
        </view>
      </view>
    </view>
  </view>

  <!-- ç¼´è´¹é¡µé¢ -->
  <view wx:if="{{pageMode === 'payment'}}" class="payment-content">
    <!-- è½¦è¾†ä¿¡æ¯å¡ç‰‡ -->
    <view class="vehicle-card">
      <view class="card-header">
        <view class="switch-vehicle" bindtap="switchVehicle">
          <text>åˆ‡æ¢è½¦è¾†</text>
          <text class="switch-icon">â‡„</text>
        </view>
      </view>
      
      <view class="vehicle-info">
        <view class="info-item">
          <text class="info-label">è½¦ç‰Œ</text>
          <view class="plate-number">{{vehicle.plateNumber}}</view>
        </view>
        <view class="info-item">
          <text class="info-label">åœè½¦æ—¶é•¿</text>
          <text class="info-value">
            {{parkingDuration.hours}}æ—¶{{parkingDuration.minutes}}åˆ†{{parkingDuration.seconds}}ç§’
          </text>
        </view>
      </view>
      
      <view class="divider"></view>
      
      <view class="parking-details-info">
        <view class="detail-item">
          <text class="detail-label">åœè½¦åœº</text>
          <text class="detail-value">{{vehicle.parkingLot}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å…¥åœºæ—¶é—´</text>
          <text class="detail-value">{{vehicle.entryTime}}</text>
        </view>
      </view>
    </view>

    <!-- è´¹ç”¨ä¿¡æ¯å¡ç‰‡ -->
    <view class="fee-card">
      <view class="fee-item">
        <text class="fee-label">åœè½¦è´¹ç”¨</text>
        <view class="fee-amount">Â¥ {{fee}}</view>
      </view>
    </view>

    <!-- æ”¯ä»˜å€’è®¡æ—¶ -->
    <view class="countdown">
      å‰©ä½™æ”¯ä»˜æ—¶é—´: {{paymentCountdown.minutes.toString().padStart(2, '0')}}:{{paymentCountdown.seconds.toString().padStart(2, '0')}}
    </view>

    <!-- æ”¯ä»˜æŒ‰é’® -->
    <view class="payment-btn-container">
      <button class="payment-btn" bindtap="payNow">ç«‹å³æ”¯ä»˜</button>
    </view>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <view class="bottom-nav">
      <view class="nav-item" bindtap="vehicleManagement">
        <text class="nav-item-icon">ğŸš—</text>
        <text class="nav-item-text">è½¦è¾†ç®¡ç†</text>
      </view>
      <view class="nav-item" bindtap="paymentRecords">
        <view class="nav-item-icon parking-icon-small">P</view>
        <text class="nav-item-text">ç¼´è´¹è®°å½•</text>
      </view>
      <view class="nav-item" bindtap="paymentInstructions">
        <text class="nav-item-icon">â„¹</text>
        <text class="nav-item-text">ç¼´è´¹è¯´æ˜</text>
      </view>
    </view>
  </view>
</view>
